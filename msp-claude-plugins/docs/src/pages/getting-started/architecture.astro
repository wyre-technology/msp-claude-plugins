---
import DocsLayout from '@/layouts/DocsLayout.astro';
---
<DocsLayout title="Architecture" description="MSP Claude Plugins architecture: 3-layer design, deployment patterns, and how plugins relate to MCP servers.">
  <h1>Architecture</h1>

  <p class="lead text-lg text-[var(--muted)] mb-8">
    MSP Claude Plugins uses a three-layer architecture that separates <strong>domain knowledge</strong>
    (plugins) from <strong>API connectivity</strong> (MCP servers) and <strong>vendor APIs</strong>.
  </p>

  <h2>Three-Layer Design</h2>

  <pre style="background: var(--code-bg, #1e1e2e); padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.9rem; line-height: 1.6;">
┌──────────────────────────────────────┐
│  Claude Code / Claude Desktop        │
│  + Plugins (skills, commands, prompts)│
└──────────────┬───────────────────────┘
               │
┌──────────────▼───────────────────────┐
│  MCP Servers (API connectivity)      │
│  @wyre-technology/*-mcp              │
└──────────────┬───────────────────────┘
               │ HTTPS
┌──────────────▼───────────────────────┐
│  Vendor APIs                         │
│  Autotask, Datto, Syncro, etc.       │
└──────────────────────────────────────┘</pre>

  <ul>
    <li><strong>Plugins</strong> — provide domain knowledge, skills, slash commands, and prompts. They tell Claude <em>how</em> to think about MSP workflows (triage logic, escalation rules, documentation standards).</li>
    <li><strong>MCP Servers</strong> — provide API connectivity via the Model Context Protocol. They expose vendor-specific tools (list tickets, create company, get alerts) that Claude can call.</li>
    <li><strong>Vendor APIs</strong> — the upstream REST/GraphQL APIs from Autotask, Datto RMM, ConnectWise, Syncro, IT Glue, and others.</li>
  </ul>

  <h2>Deployment Patterns</h2>

  <h3>Pattern 1: Local (Claude Code + stdio)</h3>

  <pre style="background: var(--code-bg, #1e1e2e); padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.9rem; line-height: 1.6;">
Claude Code / Desktop
    ↓ stdio
MCP Server (npx / mcpb)
    ↓ HTTPS
Vendor API (Autotask, Datto, etc.)</pre>

  <p>
    <strong>Best for:</strong> individual developers, quick testing, local development.<br/>
    The MCP server runs as a local process, communicating with Claude via stdin/stdout.
    Install with <code>npx @wyre-technology/&lt;vendor&gt;-mcp</code> or use a <code>.mcpb</code> bundle.
  </p>

  <h3>Pattern 2: Docker Self-Hosted</h3>

  <pre style="background: var(--code-bg, #1e1e2e); padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.9rem; line-height: 1.6;">
Claude Code / Desktop
    ↓ HTTP (SSE transport)
MCP Server Container (ghcr.io)
    ↓ HTTPS
Vendor API</pre>

  <p>
    <strong>Best for:</strong> teams, on-premise deployments, persistent servers.<br/>
    Run MCP servers as Docker containers with SSE transport. All servers publish container images to
    <code>ghcr.io/wyre-technology/</code>. See the <a href="/getting-started/deployment">deployment guide</a>.
  </p>

  <h3>Pattern 3: MCP Gateway (mcp.wyre.ai)</h3>

  <pre style="background: var(--code-bg, #1e1e2e); padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.9rem; line-height: 1.6;">
Claude Code / Desktop
    ↓ HTTPS + OAuth 2.1/PKCE
┌─────────────────────────────────┐
│   MCP Gateway (mcp.wyre.ai)     │
│  ┌────────────────────────────┐ │
│  │ OAuth 2.1 + PKCE           │ │
│  │ Credential Vault           │ │
│  │ (AES-256-GCM encrypted)    │ │
│  └────────────────────────────┘ │
│         ↓ HTTP (internal)       │
│  ┌──────┐ ┌──────┐ ┌──────┐   │
│  │Datto │ │Syncro│ │ ...  │   │
│  │ MCP  │ │ MCP  │ │      │   │
│  └──────┘ └──────┘ └──────┘   │
└─────────────────────────────────┘
    ↓ HTTPS
Vendor APIs</pre>

  <p>
    <strong>Best for:</strong> multi-tenant deployments, managed hosting, zero-config for end users.<br/>
    Just add a URL to Claude Desktop — no Docker, no environment variables, no config files.
    See the <a href="/getting-started/gateway">gateway documentation</a>.
  </p>

  <h2>MCPB Distribution</h2>

  <p>
    Every MCP server ships as an <code>.mcpb</code> (MCP Bundle) — a self-contained package for Claude Desktop.
    Bundles are attached to each server's GitHub Releases and include all dependencies plus a manifest
    that tells Claude Desktop exactly what credentials to prompt for.
  </p>

  <ul>
    <li>Download from the server's <a href="https://github.com/wyre-technology">GitHub releases page</a></li>
    <li>Install in Claude Desktop: Settings → MCP Servers → Install from file</li>
    <li>No terminal, no Node.js, no configuration files required</li>
    <li>Requires Claude Desktop 0.10+</li>
  </ul>

  <p>See the <a href="/getting-started/deployment">deployment guide</a> for detailed MCPB installation instructions.</p>

  <h2>Plugins vs MCP Servers</h2>

  <table>
    <thead>
      <tr><th>Aspect</th><th>Plugins</th><th>MCP Servers</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>Purpose</strong></td>
        <td>Domain knowledge &amp; workflow guidance</td>
        <td>API connectivity &amp; tool exposure</td>
      </tr>
      <tr>
        <td><strong>Contains</strong></td>
        <td>Skills, slash commands, prompts, CLAUDE.md</td>
        <td>Tool handlers, API clients, auth logic</td>
      </tr>
      <tr>
        <td><strong>Example</strong></td>
        <td>"When triaging a ticket, check for SLA breach first"</td>
        <td><code>list_tickets({"{"} status: 'open', priority: 'high' {"}"})</code></td>
      </tr>
      <tr>
        <td><strong>Installation</strong></td>
        <td>Clone into Claude's project knowledge</td>
        <td>npx, Docker, MCPB, or Gateway URL</td>
      </tr>
      <tr>
        <td><strong>Runtime</strong></td>
        <td>Loaded as context in Claude's prompt</td>
        <td>Runs as a separate process / container</td>
      </tr>
    </tbody>
  </table>

  <p>
    Plugins and MCP servers are designed to work together. Each plugin has a <code>companionPluginId</code>
    that links it to its corresponding MCP server, so Claude knows which tools complement which domain knowledge.
  </p>

  <h2>Next Steps</h2>

  <ul>
    <li><a href="/getting-started/deployment">Deployment Guide</a> — install MCP servers via npm, Docker, MCPB, or DigitalOcean</li>
    <li><a href="/getting-started/gateway">MCP Gateway</a> — hosted gateway at mcp.wyre.ai</li>
    <li><a href="/mcp-servers">MCP Servers</a> — browse all available MCP servers</li>
    <li><a href="/plugins">Plugins</a> — browse all available Claude plugins</li>
  </ul>
</DocsLayout>
